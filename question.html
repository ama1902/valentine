<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Question</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body class="page page-question" id="page">
  <main class="card">
    <p class="badge">â¤ï¸ Important Question</p>
    <h1>Will you be my Valentine?</h1>

    <p class="subtext" id="message">
      Choose wiselyâ€¦ (no pressure ğŸ‘€)
    </p>

    <p class="attempts" id="attemptsText">Number of "No" attempts: <span id="attemptCount">0</span></p>

    <div class="btn-row">
      <!-- YES: links to response.html -->
      <a class="btn btn-yes" id="yesBtn" href="response.html">Yes ğŸ’š</a>

      <!-- NO: mischievous -->
      <button class="btn btn-no" id="noBtn" type="button">No â¤ï¸â€ğŸ©¹</button>
    </div>

    <p class="tiny-note">
      <!-- Tip: customize these lines freely -->
      PS: The â€œNoâ€ button isâ€¦ shy.
    </p>
  </main>

  <!-- Small overlay for hearts burst when YES -->
  <div class="hearts-layer" id="heartsLayer" aria-hidden="true"></div>

  <script>
    // ----------------------------
    // Customize-friendly variables
    // ----------------------------
    const noTexts = ["Nope!", "Are you sure?", "Really??", "Try Yes instead! ğŸ˜‰"];
    const maxEscapesBeforeHint = 3;

    // ----------------------------
    // Element refs
    // ----------------------------
    const page = document.getElementById("page");
    const noBtn = document.getElementById("noBtn");
    const yesBtn = document.getElementById("yesBtn");
    const message = document.getElementById("message");
    const attemptCountEl = document.getElementById("attemptCount");
    const heartsLayer = document.getElementById("heartsLayer");

    // ----------------------------
    // State
    // ----------------------------
    let noAttempts = 0;
    let textIndex = 0;
    let hasFirstNoClicked = false;

    // Place the "No" button in a movable wrapper so we can position it freely
    // without breaking layout.
    const wrap = document.createElement("div");
    wrap.className = "no-wrap";
    noBtn.parentNode.insertBefore(wrap, noBtn);
    wrap.appendChild(noBtn);

    // Give wrapper initial positioning
    wrap.style.position = "relative";
    noBtn.style.position = "relative";

    // Utility: update counter
    function setAttempts(n) {
      noAttempts = n;
      attemptCountEl.textContent = String(noAttempts);
    }

    // Utility: move "No" button somewhere nearby, but not off-screen
    function moveNoButton() {
      const maxX = 140;  // gentle movement: funny, not impossible
      const maxY = 90;

      // random shift
      const x = Math.floor((Math.random() * (maxX * 2 + 1)) - maxX);
      const y = Math.floor((Math.random() * (maxY * 2 + 1)) - maxY);

      noBtn.style.transform = `translate(${x}px, ${y}px)`;
    }

    // Utility: cycle button text
    function cycleNoText() {
      textIndex = (textIndex + 1) % noTexts.length;
      noBtn.textContent = noTexts[textIndex];
    }

    // 1) First click on "No": background turns red + achievement message
    noBtn.addEventListener("click", () => {
      setAttempts(noAttempts + 1);
      cycleNoText();

      if (!hasFirstNoClicked) {
        hasFirstNoClicked = true;
        page.classList.add("heartbreak");
        message.textContent = "Achievement Unlocked: Breaking My Heart ğŸ’” Try again?";
      } else {
        // escalate funny messages, but keep it light
        if (noAttempts === 2) {
          message.textContent = "Hmmâ€¦ that button feels very confident. ğŸ˜…";
        } else if (noAttempts === 3) {
          message.textContent = "Okay okay! How about 'Yes' instead? â¤ï¸";
        } else if (noAttempts === 5) {
          message.textContent = "Fine, I'll ask louder: PLEASE BE MY VALENTINE! â¤ï¸";
        } else if (noAttempts > 6) {
          message.textContent = "At this point, the 'Yes' button is blushing. ğŸ¥°";
        } else {
          message.textContent = "Try againâ€¦ I dare you. ğŸ˜‡";
        }
      }

      // After a few attempts, make the No button even more shy (but still possible!)
      if (noAttempts >= maxEscapesBeforeHint) {
        noBtn.classList.add("extra-squirmy");
      }

      moveNoButton();
    });

    // 2) "No" button moves randomly when mouse hovers near it
    // We trigger movement when the pointer approaches the button.
    document.addEventListener("mousemove", (e) => {
      const rect = noBtn.getBoundingClientRect();
      const cx = rect.left + rect.width / 2;
      const cy = rect.top + rect.height / 2;

      const dx = e.clientX - cx;
      const dy = e.clientY - cy;
      const distance = Math.sqrt(dx * dx + dy * dy);

      // Start escaping when within radius, but not constantly
      const radius = noBtn.classList.contains("extra-squirmy") ? 140 : 110;

      if (distance < radius) {
        moveNoButton();
        cycleNoText();
      }
    });

    // 4) After 3 failed attempts, show a helpful hint (done above at attempt 3)

    // YES click: celebratory transition + hearts burst, then navigate
    yesBtn.addEventListener("click", (e) => {
      e.preventDefault();

      // reset heartbreak styling gently
      page.classList.remove("heartbreak");
      message.textContent = "YAY!! Thatâ€™s the answer I was hoping for! ğŸ’";

      // show a hearts burst
      heartsBurst(22);

      // smooth fade out, then go
      document.body.classList.add("page-fade-out");
      setTimeout(() => {
        window.location.href = yesBtn.href;
      }, 650);
    });

    // Hearts burst effect
    function heartsBurst(count = 18) {
      heartsLayer.innerHTML = "";
      heartsLayer.classList.add("show");

      for (let i = 0; i < count; i++) {
        const heart = document.createElement("div");
        heart.className = "burst-heart";
        heart.textContent = ["ğŸ’—","ğŸ’–","ğŸ’˜","ğŸ’","ğŸ’•"][Math.floor(Math.random()*5)];

        // random start near center-ish
        const startX = 50 + (Math.random() * 18 - 9);
        const startY = 55 + (Math.random() * 12 - 6);
        heart.style.left = startX + "%";
        heart.style.top = startY + "%";

        // random drift
        heart.style.setProperty("--dx", (Math.random() * 260 - 130) + "px");
        heart.style.setProperty("--dy", (Math.random() * -260 - 80) + "px");
        heart.style.setProperty("--rot", (Math.random() * 120 - 60) + "deg");
        heart.style.animationDelay = (Math.random() * 120) + "ms";

        heartsLayer.appendChild(heart);
      }

      setTimeout(() => heartsLayer.classList.remove("show"), 1100);
    }
  </script>
</body>
</html>
